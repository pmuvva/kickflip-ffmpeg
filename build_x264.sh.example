#!/bin/bash

#### PLEASE DO NOT MODIFY THIS EXAMPLE FILE
#### THIS IS MEANT ONLY AS REFERENCE FOR YOUR OWN VERSION

cd x264

HOSTARCH=
## Examples:
## HOSTARCH=darwin-x86_64
## HOSTARCH=linux-x86_64

NDK=
## Example:
## NDK=$HOME/ndk/android-ndk-r15c

SYSROOT=$NDK/platforms/android-21/arch-arm/
TOOLCHAIN=$NDK/toolchains/arm-linux-androideabi-4.9/prebuilt/$HOSTARCH
# Note: Change the TOOLCHAIN to match that available for your host system.
# darwin-x86_64 is for Mac OS X, but you knew that.


CPU=arm
PREFIX=$(pwd)/../android/$CPU/
EXTRAFLAGS=""

function build_one
{
  echo $(pwd)
  ./configure \
  --prefix=$PREFIX \
  --enable-static \
  --enable-shared \
  --enable-pic \
  --disable-cli \
  --host=arm-linux \
  --cross-prefix=$TOOLCHAIN/bin/arm-linux-androideabi- \
  --sysroot=$SYSROOT \
  --extra-ldflags=$EXTRAFLAGS

  # we need to remove the API version after .so because the NDK tool
  # cannot handle shared libraries not ending in .so

  # For OS X:
  #sed -i '' 's/libx264.so.152/libx264-152.so/g' config.mak

  # for ubuntu:
  sed -i 's/libx264.so.152/libx264-152.so/g' config.mak

  make clean
  make
  make install

}

build_one
